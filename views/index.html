<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css?family=Radley" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	 <link rel="stylesheet" href="/style.css">
	</head>
		<center>
	
			<header>
		<div id = "wrapper">

			<h1 class ="title">
				Infinitum
			</h1>
			<h1 class = "subtitle">
				Nightlife Coordination App
			</h1>

			<form method = "POST" action="/searching">
				<input placeholder = "Search your location" class = "citySearch" name ="city">
				<button class = "subBut" type = "submit">
				Search
				</button>
			</form>

			</div>
			</header>
			</center>

			<div id = "photoGallery">
			</div>
			<body>
			<div id = "app">
				</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>

    <script type="text/babel">


    	//Parse Cookies Start
    var w;
    var alp = document.cookie.split(";")
    
    //User Parse 
    var user = "";
     for(var i=0; i<alp.length; i++){
        var z = alp[i].split("=");     
        if(alp[i].split("=")[0] == "uName" || alp[i].split("=")[0] == " uName"){
         
          w = i;
        }
    }
    if(w>=0){
    var a = alp[w].split("=");
     user = a[1] 
    }
      //Location Parse
		for(var i=0; i< alp.length; i++){
        var z = alp[i].split("=");     
        if(alp[i].split("=")[0] == " locs" ||alp[i].split("=")[0] == "locs" ){
          w = i;
        }
    }

     var a = alp[w].split("=");
    var b = a[1].replace(/%20/g," ");
    var c = b.replace(/%3A/g,":");
    var d = c.replace(/%22/g, '"');
    var e = d.replace(/%3A/g, ":");
    var f = e.replace(/%5B%7B/g,"[{")
    var g = f.replace(/%7D%5D/g, "}]")
    var h = g.replace(/%7D/g, "}")
    var j = h.replace(/%7B/g, "{")
    var k = j.replace(/%3F/g,"?");
    var l = k.replace(/%2C/g,",");
    var m = l.replace(/j:/g,"")
    var n = m.slice(3,m.length)
    var final = n.slice(0,n.length-3)
    var final2 = final.replace(/%26/g, "&")
    var dataset = final2.split(",")

    //Image source Parse
		for(var i=0; i< alp.length; i++){
        var z = alp[i].split("=");     
        if(alp[i].split("=")[0] == " photos" ||alp[i].split("=")[0] == "photos" ){
          w = i;
        }
    }
     var a = alp[w].split("=");
    var b = a[1].replace(/%20/g," ");
    var c = b.replace(/%3A/g,":");
    var d = c.replace(/%22/g, '"');
    var e = d.replace(/%3A/g, ":");
    var f = e.replace(/%5B%7B/g,"[{")
    var g = f.replace(/%7D%5D/g, "}]")
    var h = g.replace(/%7D/g, "}")
    var j = h.replace(/%7B/g, "{")
    var k = j.replace(/%3F/g,"?");
    var l = k.replace(/%2C/g,",");
    var m = l.replace(/j:/g,"")
    var n = m.slice(3,m.length)
    var final = n.slice(0,n.length-3)
    var final2 = final.replace(/%26/g, "&")
    var final3 = final2.replace(/%2F/g, "/")
    var dataset2 = final3.split(",")
    
    // ID Parse
    
    		for(var i=0; i< alp.length; i++){
        var z = alp[i].split("=");     
        if(alp[i].split("=")[0] == " eyedees" ||alp[i].split("=")[0] == "eyedees" ){
          w = i;
        }
    }
     var a = alp[w].split("=");
    var b = a[1].replace(/%20/g," ");
    var c = b.replace(/%3A/g,":");
    var d = c.replace(/%22/g, '"');
    var e = d.replace(/%3A/g, ":");
    var f = e.replace(/%5B%7B/g,"[{")
    var g = f.replace(/%7D%5D/g, "}]")
    var h = g.replace(/%7D/g, "}")
    var j = h.replace(/%7B/g, "{")
    var k = j.replace(/%3F/g,"?");
    var l = k.replace(/%2C/g,",");
    var m = l.replace(/j:/g,"")
    var n = m.slice(3,m.length)
    var final = n.slice(0,n.length-3)
    var final2 = final.replace(/%26/g, "&")
    var final3 = final2.replace(/%2F/g, "/")
    var dataset3 = final3.split(",")
    
    
    //PARSE GOING 
        		for(var i=0; i< alp.length; i++){
        var z = alp[i].split("=");     
        if(alp[i].split("=")[0] == " going" ||alp[i].split("=")[0] == "going" ){
          w = i;
        }
    }
    
    var dataset4 =[];
         var a = alp[w].split("=");
    var b = a[1].replace(/%20/g," ");
    var c = b.replace(/%3A/g,":");
    var d = c.replace(/%22/g, '"');
    var e = d.replace(/%3A/g, ":");
    var f = e.replace(/%5B%7B/g,"[{")
    var g = f.replace(/%7D%5D/g, "}]")
    var h = g.replace(/%7D/g, "}")
    var j = h.replace(/%7B/g, "{")
    var k = j.replace(/%3F/g,"?");
    var l = k.replace(/%2C/g,",");
    var m = l.replace(/j:/g,"")
    var n = m.slice(3,m.length)
    var final = n.slice(0,n.length-3)
    var final2 = final.replace(/%26/g, "&")
    var final3 = final2.replace(/%2F/g, "/")
    var final4 = final3.replace(/%5B/g, "[")
    var final5 = final4.replace(/%5D/g,"]")
    var final6 = final5.slice(1, final5.length-1)
     dataset4 = final6.split("],[")
    console.log(dataset4.length)
    
    
    //Parse cookies end

    var NameBox = React.createClass({
    getInitialState: function(){
    return {isGoing: false}
    },
    willGo: function(){
        var go = [];
    if(this.props.goers !== undefined){
     go = this.props.goers.split(",")
       if(go[0] < 1){
       go = [];
       }
    }
    return (	    <div>
      <center>
      <form method = "POST" action = "/removePlace"> 
    	<h1>{this.props.ident}</h1>
      <input type="hidden" name = "place" value = {this.props.eyedee}/>
    	<img className ="imgs" src = {this.props.image}/>
      <h3>Going: {go.length}</h3>
            <ul>
      {go.map((x,i)=>{
      return(
      <li>
      {x}
      </li>)
      })}
      </ul>
       
      <br/><br/>
      <button className = "notGoingBtn" value = {this.props.eyedee}>Not Going</button>
      </form>
      </center>
    </div>)
    },
    notGoing: function(){
        var go = [];
    if(this.props.goers !== undefined){
     go = this.props.goers.split(",")
       if(go[0] < 1){
       go = [];
       }
    }
    	return(
	    <div>
      <center>
      <form method = "POST" action = "/addPlace"> 
    	<h1>{this.props.ident}</h1>
      <input type="hidden" name = "place" value = {this.props.eyedee}/>
    	<img className ="imgs" src = {this.props.image}/>
      <h3>Going: {go.length}</h3>
            <ul>
      {go.map((x,i)=>{
      if(x.slice(1,x.length-1) == user){
      this.setState({isGoing: true})
      }
      return(
      <li>
      {x}
      </li>)
      })}
      </ul>
       
      <br/><br/>
      <button className = "goingBtn" value = {this.props.eyedee}>Going</button>
      </form>
      </center>
    </div>
  	)
    },
    render: function(){
    


  if(!this.state.isGoing){
  return this.notGoing();
  }
  if(this.state.isGoing){
  return this.willGo();
  }
}
});



	var Main = React.createClass({
	getInitialState: function(){
	return {
  locations: dataset,
  images: dataset2,
  identifier: dataset3,
  goingArr: dataset4,
  home: true,
  register: false,
  login: false
  }
},
  credentialsButton: function(){

  if(user.length === 0){
      return(<button onClick = {()=>{return this.setState({login: true, home: false})}} className = "subBut">
      Login
      </button>)
  }
  else if (user.length>0){
      return(<a href ="/logout"><button className = "subBut">
      Logout
      </button></a>)
  }
  
  },
  home: function(){
  	return(
	<div>

    <br/>
    <span className = "uName">
    {user}
    </span>
        <center>
        {this.credentialsButton()}
     <button onClick = {()=>{return this.setState({register: true, home: false})}} className = "subBut">
      Register
      </button>
      </center>
		<ul>
			{
		this.state.locations.map((x,i)=>{
    console.log("length"+this.state.locations)
		var insert = x.slice(1, x.length-1)
		var image = this.state.images[i].slice(1, this.state.images[i].length-1)
    var ayedee = this.state.identifier[i].slice(1, this.state.identifier[i].length-1)
		var goData = this.state.goingArr[i]
		return(
		<li className = "box">
			<NameBox key ={i} eyedee = {ayedee} ident = {insert} image = {image} goers = {goData} />
		</li>
		)
	})
	}
</ul>

	</div>
  )
},
  register: function(){
   document.getElementById("app").scrollIntoView({behavior: "smooth", block: "start", inline: "nearest"});
    return(
    <div className = "registerPage">
    <center>
    <h1> Register </h1>
    <form method = "POST" action = "/register">
    <h2>
    New Username
    </h2><br/>
    <input className = "citySearch" name = "user"/>
    <h2>Password</h2><br/>
    <input className = "citySearch" name = "password" type = "password"/>
    <h2>Confirm Password </h2><br/>
    <input className = "citySearch" name = "confirm" type = "password"/>
    <br/><br/><br/>
    <button className = "subBut" type="submit">Register</button>
    <button className = "subBut" type="button" onClick = {()=>{return this.setState({register: false, home: true})}}>
    Back</button>
    </form>
    </center>
    </div>
    )
  },
  login: function(){
   document.getElementById("app").scrollIntoView({behavior: "smooth", block: "start", inline: "nearest"});
  return(
  <div className ="registerPage">
  <center>
  <h1> Login </h1>
    <form method = "POST" action="/login">
    <h2> Username </h2><br/>
    <input className="citySearch" name = "user"/>
    <h2> Password </h2>
    <input className="citySearch" type="password" name = "password"/><br/><br/>
    <button type = "submit" className = "subBut">Login </button>
    <button type = "button" className = "subBut" onClick = {()=>{return this.setState({login: false, home: true})}}>Back </button>
    </form>
    </center>
  </div>
  )
  },
	render: function(){
  
  if(this.state.home){
  return this.home();
  }
  if(this.state.register){
  return this.register();
  }
  if(this.state.login){
  return this.login();
  }
}
})



    ReactDOM.render(<Main/>, document.getElementById('app'))
      document.getElementById("app").scrollIntoView({behavior: "smooth", block: "start", inline: "nearest"});
    </script>
		<script src = "/home.js">

		</script>
	</body>
</html>